<div class="main-content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header card-header-info">
                        <h4 class="card-title" *ngIf="isAdd">{{ 'leases.create.title' | translate }}
                            <ng-container *ngIf="formError$ | async">
                                <mat-icon color="warn">error_outline</mat-icon>
                            </ng-container>
                        </h4>
                        <h4 class="card-title" *ngIf="!isAdd">{{ 'leases.edit.title' | translate }}
                            <ng-container *ngIf="formError$ | async">
                                <mat-icon color="warn">error_outline</mat-icon>
                            </ng-container>
                        </h4>
                    </div>

                    <div class="card-body">

                        <mat-vertical-stepper [linear]="isLinear" #stepper>
                            <mat-step [stepControl]="leaseDetailsFormGroup">
                                <ng-template matStepLabel>{{ 'leases.field.lease_info' | translate }}</ng-template>

                                <form [formGroup]="leaseDetailsFormGroup">
                                    <div class="row">
                                        <div class="col-12 col-sm-6 col-md-6 col-lg-4 col-xl-4">

                                            <ng-container *ngIf="!isAdd">
                                                <mat-form-field class="full-width" color="primary" appearance="outline">
                                                    <mat-label>{{ 'leases.field.property' | translate }}</mat-label>
                                                    <input matInput formControlName="property">
                                                </mat-form-field>
                                            </ng-container>

                                            <ng-container *ngIf="isAdd">
                                                <mat-form-field color="primary" appearance="outline">
                                                    <mat-label>{{ 'leases.field.property' | translate }}</mat-label>
                                                    <mat-select formControlName="property" #propertySelect
                                                                (selectionChange)="onPropertyItemChange(propertySelect.value)">
                                                        <mat-option>
                                                            <ngx-mat-select-search
                                                                    [formControl]="propertyServerSideFilteringCtrl"
                                                                    [searching]="searching"
                                                                    placeholderLabel="{{ 'leases.field.find_property' | translate }}"
                                                                    noEntriesFoundLabel="{{ 'leases.field.no_matching_property' | translate }}">
                                                            </ngx-mat-select-search>
                                                        </mat-option>
                                                        <mat-option *ngFor="let property of propertiesFiltered$ | async"
                                                                    [value]="property">
                                                            {{property.property_name}} {{property.location}}
                                                        </mat-option>
                                                    </mat-select>
                                                    <mat-error align="start" *ngIf="formErrors?.property_id"
                                                               class="form__error">{{ formErrors.property_id }}</mat-error>
                                                </mat-form-field>
                                            </ng-container>
                                        </div>
                                        <div class="col-12 col-sm-6 col-md-6 col-lg-4 col-xl-4">

                                            <ng-container *ngIf="!isAdd">
                                                <mat-form-field class="full-width" color="primary" appearance="outline">
                                                    <mat-label>{{ 'leases.field.units' | translate }}</mat-label>
                                                    <input matInput formControlName="units">
                                                </mat-form-field>
                                            </ng-container>

                                            <ng-container *ngIf="isAdd">
                                                <mat-form-field class="full-width" color="primary" appearance="outline">
                                                    <mat-label>{{ 'leases.field.units' | translate }}</mat-label>
                                                    <mat-select [formControl]="unitsCtrl" placeholder="Units"
                                                                [multiple]="true" #unitSelect>
                                                        <mat-option>
                                                            <ngx-mat-select-search [formControl]="unitMultiFilterCtrl"
                                                                                   [searching]="searching"
                                                                                   placeholderLabel="{{ 'leases.field.find_unit' | translate }}"
                                                                                   noEntriesFoundLabel="{{ 'leases.field.no_matching_unit' | translate }}">
                                                            </ngx-mat-select-search>
                                                        </mat-option>
                                                        <mat-option *ngFor="let unit of filteredUnitsMulti | async"
                                                                    [value]="unit">
                                                            {{unit.unit_name}}
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field>
                                            </ng-container>

                                        </div>
                                        <div class="col-12 col-sm-6 col-md-6 col-lg-4 col-xl-4">
                                            <mat-form-field class="full-width" color="primary" appearance="outline">
                                                <mat-label>{{ 'leases.field.lease_type' | translate }}</mat-label>
                                                <mat-select placeholder="{{ 'leases.field.lease_type' | translate }}"
                                                            formControlName="lease_type_id">
                                                    <mat-option *ngFor="let leaseType of leaseTypes$ | async"
                                                                [value]="leaseType.id">
                                                        {{leaseType.lease_type_display_name}}
                                                    </mat-option>
                                                </mat-select>
                                                <mat-error align="start" *ngIf="formErrors?.lease_type_id"
                                                           class="form__error">{{ formErrors.lease_type_id }}</mat-error>
                                            </mat-form-field>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-12 col-sm-6 col-md-6 col-lg-4 col-xl-4">
                                            <mat-form-field class="full-width" color="primary" appearance="outline">
                                                <mat-label>{{ 'leases.field.rent_amount' | translate }}</mat-label>
                                                <input matInput type="number" min="0" formControlName="rent_amount"
                                                       placeholder="{{ 'leases.field.rent_amount' | translate }}">
                                                <mat-error align="start" *ngIf="formErrors?.rent_amount"
                                                           class="form__error">{{ formErrors.rent_amount }}</mat-error>
                                            </mat-form-field>
                                        </div>
                                        <div class="col-12 col-sm-6 col-md-6 col-lg-4 col-xl-4">
                                            <mat-form-field class="full-width" color="primary" appearance="outline">
                                                <mat-label>{{ 'leases.field.start_date' | translate }}</mat-label>
                                                <input matInput (click)="start_date.open()" [matDatepicker]="start_date"
                                                       formControlName="start_date"
                                                       placeholder="{{ 'leases.field.start_date' | translate }}">
                                                <mat-datepicker-toggle matSuffix
                                                                       [for]="start_date"></mat-datepicker-toggle>
                                                <mat-datepicker touchUi #start_date></mat-datepicker>
                                                <mat-error align="start" *ngIf="formErrors?.start_date"
                                                           class="form__error">{{ formErrors.start_date }}</mat-error>
                                            </mat-form-field>
                                        </div>
                                        <div class="col-12 col-sm-6 col-md-6 col-lg-4 col-xl-4">
                                            <mat-form-field class="full-width" color="primary" appearance="outline">
                                                <mat-label>{{ 'leases.field.due_on' | translate }}</mat-label>
                                                <mat-select formControlName="due_on">
                                                    <mat-option *ngFor="let day of dueON" [value]="day">
                                                        {{day}}
                                                    </mat-option>
                                                </mat-select>
                                                <mat-error align="start" *ngIf="formErrors?.due_on"
                                                           class="form__error">{{ formErrors.due_on }}</mat-error>
                                            </mat-form-field>
                                        </div>
                                    </div>
                                    <div>
                                        <button class="mat-raised-button" color="accent" mat-button matStepperNext
                                                type="button">
                                            <span>{{ 'next' | translate }}</span>
                                            <mat-icon color="material-icons">arrow_right</mat-icon>
                                        </button>
                                    </div>

                                </form>
                            </mat-step>


                            <ng-container>
                                <mat-step [stepControl]="depositsFormGroup">
                                    <form [formGroup]="depositsFormGroup">
                                        <ng-template matStepLabel>{{ 'leases.field.deposits' | translate }}</ng-template>


                                        <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">
                                            <mat-form-field class="full-width" color="primary" appearance="outline">
                                                <mat-label>{{ 'leases.field.rent_deposit_amount' | translate }}</mat-label>
                                                <input matInput formControlName="rent_deposit"
                                                       placeholder="{{ 'leases.field.rent_deposit_amount' | translate }}">
                                                <mat-error align="start" *ngIf="formErrors?.rent_deposit"
                                                           class="form__error">{{ formErrors.rent_deposit }}</mat-error>
                                            </mat-form-field>
                                        </div>

                                        <div formArrayName="utilityDeposits"
                                             *ngFor="let utilityDeposit of utilityDepositFieldsAll.controls; let i = index;">
                                            <div class="row col-sm-12" [formGroupName]="i">
                                                <div class="col-4 col-sm-4 col-md-4 col-lg-4 col-xl-4">
                                                    <mat-form-field class="full-width" color="primary"
                                                                    appearance="outline">
                                                        <mat-label> {{i + 1}}. {{ 'leases.field.utility_name' | translate }}</mat-label>
                                                        <mat-select placeholder="{{ 'leases.field.utility_name' | translate }}"
                                                                    formControlName="utility_id">
                                                            <mat-option *ngFor="let utility of utilities$ | async"
                                                                        [value]="utility.id">
                                                                {{utility.utility_display_name}}
                                                            </mat-option>
                                                        </mat-select>
                                                        <mat-error align="start" *ngIf="formErrors?.utility_id"
                                                                   class="form__error">{{ formErrors.utility_id }}</mat-error>
                                                    </mat-form-field>
                                                </div>
                                                <div class="col-4 col-sm-4 col-md-4 col-lg-4 col-xl-4">
                                                    <mat-form-field class="full-width" color="primary"
                                                                    appearance="outline">
                                                        <mat-label>{{ 'leases.field.deposit_amount' | translate }}</mat-label>
                                                        <input matInput type="number" min="0"
                                                               formControlName="deposit_amount"
                                                               placeholder="{{ 'leases.field.deposit_amount' | translate }}">
                                                        <mat-error align="start" *ngIf="formErrors?.deposit_amount"
                                                                   class="form__error">{{ formErrors.deposit_amount }}</mat-error>
                                                    </mat-form-field>
                                                </div>

                                                <div class="col-4 col-sm-4 col-md-4 col-lg-4 col-xl-4" *ngIf="isAdd">
                                                    <button class="btn btn-link btn-sm btn-just-icon"
                                                            (click)="utilityDepositFieldCopy(i)"
                                                            mat-icon-button
                                                           >
                                                        <mat-icon>file_copy</mat-icon>
                                                    </button>
                                                    <button class="btn btn-link btn-sm btn-just-icon"
                                                            (click)="utilityDepositFieldRemove(i)"
                                                            mat-icon-button color="accent">
                                                        <mat-icon color="warn">close</mat-icon>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row" *ngIf="isAdd">
                                            <div class="col-6">
                                                <button (click)="utilityDepositFieldAdd()"
                                                        class="mat-stroked-button mat-accent mb-3" mat-button
                                                        type="button">
                                                    <mat-icon color="material-icons">add</mat-icon>
                                                    <span>{{ 'leases.field.add_utility deposit' | translate }}</span>
                                                </button>
                                            </div>
                                        </div>


                                        <div>
                                            <button class="mat-raised-button mr-2" color="accent" mat-button
                                                    matStepperPrevious type="button">
                                                <mat-icon color="material-icons">arrow_left</mat-icon>
                                                <span>{{ 'back' | translate }}</span>
                                            </button>
                                            <button class="mat-raised-button" color="accent" mat-button matStepperNext
                                                    type="button">
                                                <span>{{ 'next' | translate }}</span>
                                                <mat-icon color="material-icons">arrow_right</mat-icon>
                                            </button>
                                        </div>
                                    </form>
                                </mat-step>
                            </ng-container>

                            <ng-container>
                                <mat-step [stepControl]="tenantsFormGroup">
                                    <form [formGroup]="tenantsFormGroup">
                                        <ng-template matStepLabel>Tenants</ng-template>

                                        <div class="col-sm-12">

                                            <ng-container *ngIf="!isAdd">
                                                <mat-form-field class="full-width" color="primary" appearance="outline">
                                                    <mat-label>{{ 'leases.field.tenants' | translate }}</mat-label>
                                                    <input matInput formControlName="tenants">
                                                </mat-form-field>
                                            </ng-container>

                                            <ng-container *ngIf="isAdd">
                                                <mat-form-field class="full-width" color="primary" appearance="outline">
                                                    <mat-label>{{ 'leases.field.tenants' | translate }}</mat-label>
                                                    <mat-select [formControl]="tenantsCtrl" placeholder="Tenants"
                                                                [multiple]="true" #tenantSelect>
                                                        <mat-option>
                                                            <ngx-mat-select-search [formControl]="tenantMultiFilterCtrl"
                                                                                   [searching]="searching"
                                                                                   placeholderLabel="{{ 'leases.field.find_tenant' | translate }}"
                                                                                   noEntriesFoundLabel="{{ 'leases.field.no_tenant_found' | translate }}">
                                                            </ngx-mat-select-search>
                                                        </mat-option>
                                                        <mat-option *ngFor="let tenant of filteredTenantsMulti | async"
                                                                    [value]="tenant">
                                                            {{tenant.first_name}} {{tenant.last_name}}
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field>

                                                <ng-container *ngFor="let bank of tenantsCtrl?.value; let i = index;">
                                                    <div>{{i + 1}}. {{bank.first_name}} {{bank.last_name}}</div>
                                                </ng-container>
                                            </ng-container>
                                        </div>

                                        <div>
                                            <button class="mat-raised-button mr-2" color="accent" mat-button
                                                    matStepperPrevious type="button">
                                                <mat-icon color="material-icons">arrow_left</mat-icon>
                                                <span>{{ 'back' | translate }}</span>
                                            </button>
                                            <button class="mat-raised-button" color="accent" mat-button matStepperNext
                                                    type="button">
                                                <span>{{ 'next' | translate }}</span>
                                                <mat-icon color="material-icons">arrow_right</mat-icon>
                                            </button>
                                        </div>
                                    </form>
                                </mat-step>
                            </ng-container>

                            <mat-step [stepControl]="extraChargesFormGroup">
                                <form [formGroup]="extraChargesFormGroup">
                                    <ng-template matStepLabel>{{ 'extra_charge.title' | translate }}</ng-template>

                                    <!-- Start Extra Charge Fields-->
                                    <div formArrayName="extraCharges"
                                         *ngFor="let extraChargeField of extraChargeFieldAll?.controls; let i = index;">
                                        <div class="row" [formGroupName]="i">
                                            <div class="col-3 col-sm-3 col-md-3 col-lg-3 col-xl-3">

                                                <mat-form-field class="full-width" color="primary" appearance="outline">
                                                    <mat-label> {{i + 1}}. {{ 'extra_charge.field.extra_charge_name' | translate }}</mat-label>
                                                    <mat-select placeholder="{{ 'extra_charge.field.extra_charge_name' | translate }}"
                                                                formControlName="extra_charge_id">
                                                        <mat-option *ngFor="let extraCharge of extraCharges$ | async"
                                                                    [value]="extraCharge.id">
                                                            {{extraCharge.extra_charge_display_name}}
                                                        </mat-option>
                                                    </mat-select>
                                                    <mat-error align="start" *ngIf="formErrors?.extra_charge_id"
                                                               class="form__error">{{ formErrors.extra_charge_id }}</mat-error>
                                                </mat-form-field>


                                            </div>

                                            <div class="col-2 col-sm-2 col-md-2 col-lg-2 col-xl-2">
                                                <mat-form-field class="full-width" color="primary" appearance="outline">
                                                    <mat-label> {{i + 1}}. {{ 'extra_charge.field.extra_charge_value' | translate }}</mat-label>
                                                    <input matInput type="number" min="0"
                                                           formControlName="extra_charge_value"
                                                           placeholder="{{ 'extra_charge.field.extra_charge_value' | translate }}">
                                                    <mat-error align="start" *ngIf="formErrors?.extra_charge_value"
                                                               class="form__error">{{ formErrors.extra_charge_value }}</mat-error>
                                                </mat-form-field>
                                            </div>

                                            <div class="col-2 col-sm-2 col-md-2 col-lg-2 col-xl-2">
                                                <mat-form-field class="full-width" color="primary" appearance="outline">
                                                    <mat-label> {{i + 1}}. {{ 'extra_charge.field.extra_charge_type' | translate }}</mat-label>
                                                    <mat-select placeholder="{{ 'extra_charge.field.extra_charge_type' | translate }}"
                                                                formControlName="extra_charge_type">
                                                        <mat-option *ngFor="let extraChargeType of extraChargeTypes"
                                                                    [value]="extraChargeType.key">
                                                            {{extraChargeType.value}}
                                                        </mat-option>
                                                    </mat-select>
                                                    <mat-error align="start" *ngIf="formErrors?.extra_charge_type"
                                                               class="form__error">{{ formErrors.extra_charge_type }}</mat-error>
                                                </mat-form-field>
                                            </div>

                                            <div class="col-2 col-sm-2 col-md-2 col-lg-2 col-xl-2">
                                                <mat-form-field class="full-width" color="primary" appearance="outline">
                                                    <mat-label> {{i + 1}}. {{ 'extra_charge.field.frequency' | translate }}</mat-label>
                                                    <mat-select placeholder="{{ 'extra_charge.field.frequency' | translate }}"
                                                                formControlName="extra_charge_frequency">
                                                        <mat-option
                                                                *ngFor="let extraChargeFrequency of extraChargeFrequencies"
                                                                [value]="extraChargeFrequency.key">
                                                            {{extraChargeFrequency.value}}
                                                        </mat-option>
                                                    </mat-select>
                                                    <mat-error align="start" *ngIf="formErrors?.extra_charge_frequency"
                                                               class="form__error">{{ formErrors.extra_charge_frequency }}</mat-error>
                                                </mat-form-field>
                                            </div>

                                            <div class="col-2 col-sm-2 col-md-3 col-lg-3 col-xl-3 mt-md-3 mt-lg-3 mt-xl-3">
                                                <button class="btn btn-link btn-sm btn-just-icon"
                                                        (click)="extraChargeFieldCopy(i)"
                                                        mat-icon-button>
                                                    <mat-icon>file_copy</mat-icon>
                                                </button>
                                                <button class="btn btn-link btn-sm btn-just-icon"
                                                        (click)="extraChargeFieldRemove(i)"
                                                        mat-icon-button color="accent">
                                                    <mat-icon color="warn">close</mat-icon>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-4">
                                        <div class="col-6">
                                            <button mat-button color="accent" (click)="extraChargeFieldAdd()"
                                                    matTooltip="Add Field">
                                                <mat-icon>add_circle_outline</mat-icon>
                                                {{ 'extra_charge.field.add_another_extra_charge' | translate }}
                                            </button>
                                        </div>
                                    </div>
                                    <!-- End Extra Charge Fields-->
                                    <div>
                                        <button class="mat-raised-button mr-2" color="accent" mat-button
                                                matStepperPrevious type="button">
                                            <mat-icon color="material-icons">arrow_left</mat-icon>
                                            <span>{{ 'back' | translate }}</span>
                                        </button>
                                        <button class="mat-raised-button" color="accent" mat-button matStepperNext
                                                type="button">
                                            <span>{{ 'next' | translate }}</span>
                                            <mat-icon color="material-icons">arrow_right</mat-icon>
                                        </button>
                                    </div>
                                </form>
                            </mat-step>


                            <mat-step [stepControl]="lateFeesFormGroup">
                                <form [formGroup]="lateFeesFormGroup">
                                    <ng-template matStepLabel>{{ 'late_fees.title' | translate }}</ng-template>
                                    <div formArrayName="lateFeeFields"
                                         *ngFor="let lateFeeField of lateFeeFieldAll.controls; let i = index;">
                                        <div [formGroupName]="i" class="mb-4">

                                            <div class="row">
                                                <div class="col-4">
                                                    <mat-form-field class="full-width" color="primary"
                                                                    appearance="outline">
                                                        <mat-label> {{i + 1}}. {{ 'late_fees.field.late_fee_name' | translate }}</mat-label>
                                                        <mat-select placeholder="{{ 'late_fees.field.late_fee_name' | translate }}"
                                                                    formControlName="late_fee_id">
                                                            <mat-option *ngFor="let lateFee of lateFees$ | async"
                                                                        [value]="lateFee.id">
                                                                {{lateFee.late_fee_display_name}}
                                                            </mat-option>
                                                        </mat-select>
                                                        <mat-error align="start" *ngIf="formErrors?.late_fee_id"
                                                                   class="form__error">{{ formErrors.late_fee_id }}</mat-error>
                                                    </mat-form-field>
                                                </div>

                                                <div class="col-4">
                                                    <mat-form-field class="full-width" color="primary"
                                                                    appearance="outline">
                                                        <mat-label> {{i + 1}}. {{ 'late_fees.field.late_fee_value' | translate }}</mat-label>
                                                        <input matInput type="number" min="0"
                                                               formControlName="late_fee_value"
                                                               placeholder="{{ 'late_fees.field.late_fee_value' | translate }}">
                                                        <mat-error align="start" *ngIf="formErrors?.late_fee_value"
                                                                   class="form__error">{{ formErrors.late_fee_value }}</mat-error>
                                                    </mat-form-field>
                                                </div>

                                                <div class="col-4">
                                                    <mat-form-field class="full-width" color="primary"
                                                                    appearance="outline">
                                                        <mat-label> {{i + 1}}. {{ 'late_fees.field.late_fee_type' | translate }}</mat-label>
                                                        <mat-select placeholder="{{ 'late_fees.field.late_fee_type' | translate }}"
                                                                    formControlName="late_fee_type">
                                                            <mat-option *ngFor="let lateFeeType of lateFeeTypes"
                                                                        [value]="lateFeeType.key">
                                                                {{lateFeeType.value}}
                                                            </mat-option>
                                                        </mat-select>
                                                        <mat-error align="start" *ngIf="formErrors?.late_fee_type"
                                                                   class="form__error">{{ formErrors.late_fee_type }}</mat-error>
                                                    </mat-form-field>
                                                </div>
                                            </div>
                                            <div class="row">

                                                <div class="col-4">
                                                    <mat-form-field class="full-width" color="primary"
                                                                    appearance="outline">
                                                        <mat-label> {{i + 1}}. {{ 'late_fees.field.grace_period' | translate }}</mat-label>
                                                        <input matInput type="number" min="0"
                                                               formControlName="grace_period"
                                                               placeholder="{{ 'late_fees.field.grace_period' | translate }}">
                                                        <mat-error align="start" *ngIf="formErrors?.grace_period"
                                                                   class="form__error">{{ formErrors.grace_period }}</mat-error>
                                                    </mat-form-field>
                                                </div>
                                                <div class="col-4">
                                                    <mat-form-field class="full-width" color="primary"
                                                                    appearance="outline">
                                                        <mat-label> {{i + 1}}. {{ 'late_fees.field.frequency' | translate }}</mat-label>
                                                        <mat-select placeholder="{{ 'late_fees.field.frequency' | translate }}"
                                                                    formControlName="late_fee_frequency">
                                                            <mat-option
                                                                    *ngFor="let lateFeeFrequency of lateFeeFrequencies"
                                                                    [value]="lateFeeFrequency.key">
                                                                {{lateFeeFrequency.value}}
                                                            </mat-option>
                                                        </mat-select>
                                                        <mat-error align="start" *ngIf="formErrors?.late_fee_frequency"
                                                                   class="form__error">{{ formErrors.late_fee_frequency }}</mat-error>
                                                    </mat-form-field>
                                                </div>

                                                <div class="col-2 col-sm-2 col-md-3 col-lg-3 col-xl-3 mt-md-3 mt-lg-3 mt-xl-3">
                                                    <button class="btn btn-link btn-sm btn-just-icon"
                                                            (click)="lateFeeFieldCopy(i)"
                                                            mat-icon-button
                                                           >
                                                        <mat-icon>file_copy</mat-icon>
                                                    </button>
                                                    <button class="btn btn-link btn-sm btn-just-icon"
                                                            (click)="lateFeeFieldRemove(i)"
                                                            mat-icon-button color="accent">
                                                        <mat-icon color="warn">close</mat-icon>
                                                    </button>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                    <div class="row mb-4">
                                        <div class="col-6">
                                            <button mat-button color="accent" (click)="lateFeeFieldAdd()"
                                                    matTooltip="Add Field">
                                                <mat-icon>add_circle_outline</mat-icon>
                                                {{ 'late_fees.field.add_another_late_fee' | translate }}
                                            </button>
                                        </div>
                                    </div>
                                    <div>
                                        <button class="mat-raised-button mr-2" color="accent" mat-button
                                                matStepperPrevious type="button">
                                            <mat-icon color="material-icons">arrow_left</mat-icon>
                                            <span>{{ 'back' | translate }}</span>
                                        </button>

                                        <button class="mat-raised-button mr-2" color="accent" mat-button matStepperNext
                                                type="button">
                                            <span>{{ 'next' | translate }}</span>
                                            <mat-icon color="material-icons">arrow_right</mat-icon>
                                        </button>
                                    </div>
                                </form>
                            </mat-step>

                            <mat-step [stepControl]="utilityChargesFormGroup">
                                <form [formGroup]="utilityChargesFormGroup">
                                    <ng-template matStepLabel>{{ 'utilities.title' | translate }}</ng-template>

                                    <!-- Start Utility Fields-->
                                    <div formArrayName="utilityCharges"
                                         *ngFor="let utilityCharge of utilityChargesAll.controls; let i = index;">
                                        <div class="row" [formGroupName]="i">
                                            <div class="col-3 col-sm-3 col-md-3 col-lg-3 col-xl-3">

                                                <mat-form-field class="full-width" color="primary" appearance="outline">
                                                    <mat-label> {{i + 1}}. {{ 'utilities.field.utility_name' | translate }}</mat-label>
                                                    <mat-select placeholder="{{ 'utilities.field.utility_name' | translate }}" formControlName="utility_id">
                                                        <mat-option *ngFor="let utility of utilities$ | async"
                                                                    [value]="utility.id">
                                                            {{utility.utility_display_name}}
                                                        </mat-option>
                                                    </mat-select>
                                                    <mat-error align="start" *ngIf="formErrors?.utility_id"
                                                               class="form__error">{{ formErrors.utility_id }}</mat-error>
                                                </mat-form-field>
                                            </div>

                                            <div class="col-2 col-sm-2 col-md-2 col-lg-2 col-xl-2">
                                                <mat-form-field class="full-width" color="primary" appearance="outline">
                                                    <mat-label> {{i + 1}}. {{ 'utilities.field.variable_cost' | translate }}</mat-label>
                                                    <input matInput formControlName="utility_unit_cost"
                                                           placeholder="{{ 'utilities.field.variable_cost' | translate }}">
                                                    <mat-error align="start" *ngIf="formErrors?.utility_unit_cost"
                                                               class="form__error">{{ formErrors.utility_unit_cost }}</mat-error>
                                                </mat-form-field>
                                            </div>

                                            <div class="col-2 col-sm-2 col-md-2 col-lg-2 col-xl-2">
                                                <mat-form-field class="full-width" color="primary" appearance="outline">
                                                    <mat-label> {{i + 1}}. {{ 'utilities.field.fixed_fee' | translate }}</mat-label>
                                                    <input matInput type="number" min="0"
                                                           formControlName="utility_base_fee" placeholder="{{ 'utilities.field.fixed_fee' | translate }}">
                                                    <mat-error align="start" *ngIf="formErrors?.utility_base_fee"
                                                               class="form__error">{{ formErrors.utility_base_fee }}</mat-error>
                                                </mat-form-field>
                                            </div>

                                            <div class="col-2 col-sm-2 col-md-3 col-lg-3 col-xl-3 mt-md-3 mt-lg-3 mt-xl-3">
                                                <button class="btn btn-link btn-sm btn-just-icon"
                                                        (click)="utilityChargeCopy(i)"
                                                        mat-icon-button>
                                                    <mat-icon>file_copy</mat-icon>
                                                </button>
                                                <button class="btn btn-link btn-sm btn-just-icon"
                                                        (click)="utilityChargeRemove(i)"
                                                        mat-icon-button color="accent">
                                                    <mat-icon color="warn">close</mat-icon>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-4">
                                        <div class="col-6">
                                            <button mat-button color="accent" (click)="utilityChargeAdd()"
                                                    matTooltip="Add Field">
                                                <mat-icon>add_circle_outline</mat-icon>
                                                {{ 'utilities.field.add_another_utility' | translate }}
                                            </button>
                                        </div>
                                    </div>
                                    <!-- End Utility Fields-->
                                    <div>
                                        <button class="mat-raised-button mr-2" color="accent" mat-button
                                                matStepperPrevious type="button">
                                            <mat-icon color="material-icons">arrow_left</mat-icon>
                                            <span>{{ 'back' | translate }}</span>
                                        </button>
                                        <button class="mat-raised-button" color="accent" mat-button matStepperNext
                                                type="button">
                                            <span>{{ 'next' | translate }}</span>
                                            <mat-icon color="material-icons">arrow_right</mat-icon>
                                        </button>
                                    </div>
                                </form>
                            </mat-step>

                            <mat-step [stepControl]="paymentMethodsFormGroup">
                                <form [formGroup]="paymentMethodsFormGroup">
                                    <ng-template matStepLabel>{{ 'payment_settings.title' | translate }}</ng-template>

                                    <!-- Start Payment Method Fields-->
                                    <div formArrayName="paymentMethodFields"
                                         *ngFor="let paymentMethodField of paymentMethodFieldsAll.controls; let i = index;">
                                        <div class="row" [formGroupName]="i">
                                            <div class="col-3 col-sm-3 col-md-3 col-lg-3 col-xl-3">
                                                <mat-form-field class="full-width" color="primary" appearance="outline">
                                                    <mat-label> {{i + 1}}. {{ 'payment_method.field.payment_method_name' | translate }}</mat-label>
                                                    <mat-select placeholder="{{ 'payment_method.field.payment_method_name' | translate }}"
                                                                formControlName="payment_method_id">
                                                        <mat-option
                                                                *ngFor="let paymentMethod of paymentMethods$ | async"
                                                                [value]="paymentMethod.id">
                                                            {{paymentMethod.display_name}}
                                                        </mat-option>
                                                    </mat-select>
                                                    <mat-error align="start" *ngIf="formErrors?.payment_method_id"
                                                               class="form__error">{{ formErrors.payment_method_id }}</mat-error>
                                                </mat-form-field>
                                            </div>

                                            <div class="col-6 col-sm-6 col-md-6 col-lg-6 col-xl-6">
                                                <mat-form-field class="full-width" color="primary" appearance="outline">
                                                    <mat-label> {{i + 1}}. {{ 'payment_method.field.payment_method_description' | translate }}</mat-label>
                                                    <input matInput formControlName="payment_method_description"
                                                           placeholder="{{ 'payment_method.field.payment_method_description' | translate }}n">
                                                    <mat-error align="start"
                                                               *ngIf="formErrors?.payment_method_description"
                                                               class="form__error">{{ formErrors.payment_method_description }}</mat-error>
                                                </mat-form-field>
                                            </div>

                                            <div class="col-2 col-sm-2 col-md-3 col-lg-3 col-xl-3 mt-md-3 mt-lg-3 mt-xl-3">
                                                <button class="btn btn-link btn-sm btn-just-icon"
                                                        (click)="paymentMethodFieldCopy(i)"
                                                        mat-icon-button>
                                                    <mat-icon>file_copy</mat-icon>
                                                </button>
                                                <button class="btn btn-link btn-sm btn-just-icon"
                                                        (click)="paymentMethodFieldRemove(i)"
                                                        mat-icon-button color="accent">
                                                    <mat-icon color="warn">close</mat-icon>
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row mb-4">
                                        <div class="col-6">
                                            <button mat-button color="accent" (click)="paymentMethodFieldAdd()"
                                                    matTooltip="Add Field">
                                                <mat-icon>add_circle_outline</mat-icon>
                                                {{ 'payment_method.field.add_another_payment_method' | translate }}
                                            </button>
                                        </div>
                                    </div>
                                    <!-- End Payment Method Fields-->
                                    <div>
                                        <button class="mat-raised-button mr-2" color="accent" mat-button
                                                matStepperPrevious type="button">
                                            <mat-icon color="material-icons">arrow_left</mat-icon>
                                            <span>{{ 'back' | translate }}</span>
                                        </button>

                                        <button class="mat-raised-button" color="accent" mat-button matStepperNext
                                                type="button">
                                            <span>{{ 'next' | translate }}</span>
                                            <mat-icon color="material-icons">arrow_right</mat-icon>
                                        </button>
                                    </div>
                                </form>
                            </mat-step>

                            <mat-step [stepControl]="leaseSettingsFormGroup">
                                <form [formGroup]="leaseSettingsFormGroup">
                                    <ng-template matStepLabel>{{ 'leases.field.lease_Settings' | translate }}</ng-template>
                                    <div class="col-12">
                                        <mat-form-field class="full-width" color="primary" appearance="outline">
                                            <mat-label>{{ 'leases.field.generate_invoice_on' | translate }}</mat-label>
                                            <mat-select formControlName="generate_invoice_on">
                                                <mat-option *ngFor="let day of dueON" [value]="day">
                                                    {{day}}
                                                </mat-option>
                                            </mat-select>
                                            <mat-hint>{{ 'leases.field.day_of_each month_when_invoices_generated' | translate }}
                                            </mat-hint>
                                            <mat-error align="start" *ngIf="formErrors?.generate_invoice_on"
                                                       class="form__error">{{ formErrors.generate_invoice_on }}</mat-error>
                                        </mat-form-field>
                                    </div>


                                    <div class="col-12 mat-form-field mt-3 mb-3">
                                        <mat-checkbox formControlName="next_period_billing">
                                            {{ 'leases.field.next_period_billing' | translate }}
                                        </mat-checkbox>
                                    </div>

                                    <div class="col-12 mat-form-field mb-3">
                                        <mat-checkbox formControlName="waive_penalty">
                                            {{ 'leases.field.waive_penalty' | translate }}
                                        </mat-checkbox>
                                    </div>

                                    <div class="col-12 mat-form-field">
                                        <mat-checkbox formControlName="skip_starting_period">
                                            {{ 'leases.field.skip_starting_period' | translate }}
                                        </mat-checkbox>
                                    </div>

                                    <div class="mt-4">
                                        <button class="mat-raised-button mr-2" color="accent" mat-button
                                                matStepperPrevious type="button">
                                            <mat-icon color="material-icons">arrow_left</mat-icon>
                                            <span>{{ 'back' | translate }}</span>
                                        </button>
                                    </div>
                                </form>
                            </mat-step>

                        </mat-vertical-stepper>

                        <div class="d-flex justify-content-center spinner-container mb-2" *ngIf="loader">
                            <mat-progress-bar
                                    color="primary"
                                    mode="query"
                                    value=50
                                    bufferValue=75>
                            </mat-progress-bar>
                        </div>

                        <div>
                            <ng-container *ngIf="isAdmin$ | async">
                                <button *ngIf="!isAdd" [disabled]="loader" mat-button class="mr-2" color="warn"
                                        (click)="openConfirmationDialog(lease)">
                                    <mat-icon>delete</mat-icon>
                                    {{ 'delete' | translate }}
                                </button>
                            </ng-container>
                            <button class="mat-raised-button mat-primary float-right" mat-button type="button"
                                    (click)="createOrUpdate()">
                                <span>{{ 'leases.field.save_lease' | translate }}</span>
                            </button>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
